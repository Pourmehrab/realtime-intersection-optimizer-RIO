
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Intersection &#8212; AVIAN 1.0.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Trajectory Planner" href="[3].trajectory.html" />
    <link rel="prev" title="Input/Output" href="[1].traffic.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="[3].trajectory.html" title="Trajectory Planner"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="[1].traffic.html" title="Input/Output"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="ReadMe.html">AVIAN 1.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-src.inter.signal">
<span id="intersection"></span><h1>Intersection<a class="headerlink" href="#module-src.inter.signal" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="src.inter.signal.ActuatedControl">
<em class="property">class </em><code class="descclassname">src.inter.signal.</code><code class="descname">ActuatedControl</code><span class="sig-paren">(</span><em>inter_name</em>, <em>allowable_phases</em>, <em>num_lanes</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#ActuatedControl"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.ActuatedControl" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#src.inter.signal.Signal" title="src.inter.signal.Signal"><code class="xref py py-class docutils literal notranslate"><span class="pre">src.inter.signal.Signal</span></code></a></p>
<p># todo: main problem is how to schedule the departures</p>
<dl class="attribute">
<dt id="src.inter.signal.ActuatedControl.LAG">
<code class="descname">LAG</code><em class="property"> = 1</em><a class="headerlink" href="#src.inter.signal.ActuatedControl.LAG" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.ActuatedControl.LARGE_NUM">
<code class="descname">LARGE_NUM</code><em class="property"> = 999999</em><a class="headerlink" href="#src.inter.signal.ActuatedControl.LARGE_NUM" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="src.inter.signal.ActuatedControl._schedule_unserved_vehicles">
<code class="descname">_schedule_unserved_vehicles</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>served_vehicle_time</em>, <em>any_unserved_vehicle</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.ActuatedControl._schedule_unserved_vehicles" title="Permalink to this definition">¶</a></dt>
<dd><p>Sometimes the base SPaT prior to running a <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method does not serve all vehicles. However, vehicles
require trajectory to be provided. One way to address this is to assign them the best temporal trajectory which
only has some of general qualities necessary for continuation of program. In this method we do the followings
to compute the <code class="docutils literal notranslate"><span class="pre">departure</span> <span class="pre">times</span></code> of such trajectories:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>Without use of phases, schedule vehicles one after the other at minimum headway restricted by the</dt>
<dd>saturation headway. This gives an overestimate of teh departure time since one vehicle gets served by
intersection at a time, while having allowing to depart in phases let multiple simultaneous departures.</dd>
</dl>
</li>
<li>This may be called after a signal <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method decided to complete those that did not get served.</li>
<li>Also this assumes min headway after green starts instead of <code class="docutils literal notranslate"><span class="pre">LAG</span></code> time which is a simplification.</li>
<li><dl class="first docutils">
<dt>If a vehicle gets a schedule and has more than one trajectory point, the last index should reset to the</dt>
<dd>first index so when the trajectory is set there would be two points.</dd>
</dl>
</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since the departure times are definitely temporal, DO NOT set <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>served_vehicle_time</strong> – includes schedule of departures for those served by base SPaT</li>
<li><strong>any_unserved_vehicle</strong> – <cite>Has `False`</cite> for the lane that has all vehicles scheduled through base SPaT and the <code class="docutils literal notranslate"><span class="pre">solve()</span></code>, <code class="docutils literal notranslate"><span class="pre">True</span></code> otherwise.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><code class="docutils literal notranslate"><span class="pre">served_vehicle_time</span></code> that now includes the schedules of all vehicle except those served through base SPaT</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.ActuatedControl._set_lane_lane_incidence">
<code class="descname">_set_lane_lane_incidence</code><span class="sig-paren">(</span><em>num_lanes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.ActuatedControl._set_lane_lane_incidence" title="Permalink to this definition">¶</a></dt>
<dd><p>This converts a dictionary of the form:
key is a lane and value is <em>set</em> of lanes that are in conflict with key (note numbering starts from 1 not 0)
to <code class="docutils literal notranslate"><span class="pre">lane_lane_incidence</span></code> which includes the conflict matrix <span class="math notranslate nohighlight">\(|L|*|L|\)</span> where element <span class="math notranslate nohighlight">\(ij\)</span>
is 1 if <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> are
conflicting movements</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>num_lanes</strong> – </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.ActuatedControl._set_non_base_scheduled_arrival">
<code class="descname">_set_non_base_scheduled_arrival</code><span class="sig-paren">(</span><em>lanes</em>, <em>scheduled_arrivals</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.ActuatedControl._set_non_base_scheduled_arrival" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the scheduled departure in the trajectory of the vehicle.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Departure schedule of those which were served by base SPaT is set in <code class="docutils literal notranslate"><span class="pre">base_badness()</span></code> and not here.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lanes</strong> – </li>
<li><strong>scheduled_arrivals</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – by default the departure speed is maximum allowable speed in <span class="math notranslate nohighlight">\(m/s\)</span></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.ActuatedControl._set_phase_lane_incidence">
<code class="descname">_set_phase_lane_incidence</code><span class="sig-paren">(</span><em>num_lanes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.ActuatedControl._set_phase_lane_incidence" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the phase-phase incidence matrix of the intersection
#todo automate phase enumerator
:param num_lanes:
:return:</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.ActuatedControl.append_extend_phase">
<code class="descname">append_extend_phase</code><span class="sig-paren">(</span><em>phase</em>, <em>actual_green</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.ActuatedControl.append_extend_phase" title="Permalink to this definition">¶</a></dt>
<dd><p>Append a phase to the SPaT (append a phase and its green to the end of signal array)
Note SPaT decision is the sequence and green duration of phases</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>phase</strong> – phase to be added</li>
<li><strong>actual_green</strong> – green duration of that phase</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.ActuatedControl.base_badness">
<code class="descname">base_badness</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.ActuatedControl.base_badness" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>This method aims to serve as many vehicles as possible given the available SPaT. Depending on the signal method,</dt>
<dd><p class="first">the set of current SPaT could be different. For example:</p>
<blockquote class="last">
<div><ul class="simple">
<li><dl class="first docutils">
<dt>If called by <code class="docutils literal notranslate"><span class="pre">Pretimed()</span></code> solver, the current SPaT may include multiple phases as Pretimed SPaT never</dt>
<dd>gets flushed.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If called by <code class="docutils literal notranslate"><span class="pre">GA_SPaT()</span></code> solver, since the SPaT gets flushed before calling. The goal is to serve as</dt>
<dd>many vehicles with only the single current phase in SPaT.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd>
<dt>The condition to be served is to meet the following criteria:</dt>
<dd><ul class="first last simple">
<li>Respect the minimum headway to the lead vehicle (if present)</li>
<li>Respect the initiation of green plus a lag time specified by LAG as a class variable</li>
<li>Respect the earliest available time at the stop bar controlled by the speed limit  acc/dec rates</li>
<li>Vehicle is allowed to acquire a new trajectory (<code class="docutils literal notranslate"><span class="pre">veh.redo_trj_allowed</span></code> holds True)</li>
</ul>
</dd>
</dl>
<p>The method does not compute or return the badness metric since the it does not aim to change current phase and
timing.</p>
<p>It may only gets called once per each Signal solve call prior to computation of the new SPaTs.</p>
<dl class="docutils">
<dt>The schedule keeps the earliest departures at the stop bars of each lane and gets updated when a signal decision</dt>
<dd>goes permanent. It is made by a dictionary of arrays (key is lane, value is sorted earliest departures).</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> and setting the schedule of any possible served vehicles make the main result of this
method. The <code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> will be used after this to avoid reserving and double-counting those
already served with base SPaT. This also returns <code class="docutils literal notranslate"><span class="pre">any_unserved_vehicle</span></code> array that has True if any lane has
vehicles that could not be unserved with base SPaT.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Since base SPaT never gets changed (for safety and practical reasons), any vehicle served by it has to get <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> value set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li>It is feasible that if fusion algorithm updates the info on this vehicle and wants an update on trajectory, it rolls back the <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> to be <code class="docutils literal notranslate"><span class="pre">True</span></code>. However, this should be decided outside this method.</li>
<li>The reason that this does not return schedule of departures is because they are already set inside this method. Late, the set method skips these.</li>
<li>If a vehicle gets a schedule and has more than one trajectory point, the last index should reset to the first index so when the trajectory is set there would be two points.</li>
<li>all-red from the end and <code class="docutils literal notranslate"><span class="pre">LAG</span></code> time from the beginning of a phase are note utilizes by any vehicle.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The <code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> array that keeps index off the first unserved vehicle in each lane, is</p>
</td>
</tr>
</tbody>
</table>
<p>initialized to zero before calling this method and gets updated by the end of this call. It also returns
<code class="docutils literal notranslate"><span class="pre">served_vehicle_time</span></code> that shows the schedule</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.ActuatedControl.flush_upcoming_SPaT">
<code class="descname">flush_upcoming_SPaT</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.ActuatedControl.flush_upcoming_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><p>Just leaves the first SPaT and flushes the rest
# todo maybe reduce the green time of first phase too?
:return:</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.ActuatedControl.set_critical_phase_volumes">
<code class="descname">set_critical_phase_volumes</code><span class="sig-paren">(</span><em>volumes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.ActuatedControl.set_critical_phase_volumes" title="Permalink to this definition">¶</a></dt>
<dd><p>Not used in GA since the phasing configuration is unknown prior to cycle length formula
that is derived from time budget concept</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not call this on a signal method that does not take <code class="docutils literal notranslate"><span class="pre">allowable_phases</span></code> as input</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>volumes</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.ActuatedControl.update_SPaT">
<code class="descname">update_SPaT</code><span class="sig-paren">(</span><em>time_threshold</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.ActuatedControl.update_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Performs two tasks to update SPaT based on the given clock:</dt>
<dd><ul class="first last simple">
<li>Removes terminated phase (happens when the all-red is passed)</li>
<li>Checks for  SPaT to not get empty after being updated</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>If all phases are getting purged, either make longer SPaT decisions or reduce the simulation steps.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>time_threshold</strong> – Normally the current clock of simulation or real-time in <span class="math notranslate nohighlight">\(s\)</span></td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="src.inter.signal.Enumerate_SpaT">
<em class="property">class </em><code class="descclassname">src.inter.signal.</code><code class="descname">Enumerate_SpaT</code><span class="sig-paren">(</span><em>inter_name</em>, <em>allowable_phases</em>, <em>num_lanes</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Enumerate_SpaT"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#src.inter.signal.Signal" title="src.inter.signal.Signal"><code class="xref py py-class docutils literal notranslate"><span class="pre">src.inter.signal.Signal</span></code></a></p>
<p>Gives all phases equal chance but picks the one with highest throughput
Similar to GA functionality
:return:</p>
<dl class="attribute">
<dt id="src.inter.signal.Enumerate_SpaT.LAG">
<code class="descname">LAG</code><em class="property"> = 1</em><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT.LAG" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.Enumerate_SpaT.LARGE_NUM">
<code class="descname">LARGE_NUM</code><em class="property"> = 999999</em><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT.LARGE_NUM" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="src.inter.signal.Enumerate_SpaT._schedule_unserved_vehicles">
<code class="descname">_schedule_unserved_vehicles</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>served_vehicle_time</em>, <em>any_unserved_vehicle</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT._schedule_unserved_vehicles" title="Permalink to this definition">¶</a></dt>
<dd><p>Sometimes the base SPaT prior to running a <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method does not serve all vehicles. However, vehicles
require trajectory to be provided. One way to address this is to assign them the best temporal trajectory which
only has some of general qualities necessary for continuation of program. In this method we do the followings
to compute the <code class="docutils literal notranslate"><span class="pre">departure</span> <span class="pre">times</span></code> of such trajectories:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>Without use of phases, schedule vehicles one after the other at minimum headway restricted by the</dt>
<dd>saturation headway. This gives an overestimate of teh departure time since one vehicle gets served by
intersection at a time, while having allowing to depart in phases let multiple simultaneous departures.</dd>
</dl>
</li>
<li>This may be called after a signal <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method decided to complete those that did not get served.</li>
<li>Also this assumes min headway after green starts instead of <code class="docutils literal notranslate"><span class="pre">LAG</span></code> time which is a simplification.</li>
<li><dl class="first docutils">
<dt>If a vehicle gets a schedule and has more than one trajectory point, the last index should reset to the</dt>
<dd>first index so when the trajectory is set there would be two points.</dd>
</dl>
</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since the departure times are definitely temporal, DO NOT set <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>served_vehicle_time</strong> – includes schedule of departures for those served by base SPaT</li>
<li><strong>any_unserved_vehicle</strong> – <cite>Has `False`</cite> for the lane that has all vehicles scheduled through base SPaT and the <code class="docutils literal notranslate"><span class="pre">solve()</span></code>, <code class="docutils literal notranslate"><span class="pre">True</span></code> otherwise.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><code class="docutils literal notranslate"><span class="pre">served_vehicle_time</span></code> that now includes the schedules of all vehicle except those served through base SPaT</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Enumerate_SpaT._set_lane_lane_incidence">
<code class="descname">_set_lane_lane_incidence</code><span class="sig-paren">(</span><em>num_lanes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT._set_lane_lane_incidence" title="Permalink to this definition">¶</a></dt>
<dd><p>This converts a dictionary of the form:
key is a lane and value is <em>set</em> of lanes that are in conflict with key (note numbering starts from 1 not 0)
to <code class="docutils literal notranslate"><span class="pre">lane_lane_incidence</span></code> which includes the conflict matrix <span class="math notranslate nohighlight">\(|L|*|L|\)</span> where element <span class="math notranslate nohighlight">\(ij\)</span>
is 1 if <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> are
conflicting movements</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>num_lanes</strong> – </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Enumerate_SpaT._set_non_base_scheduled_arrival">
<code class="descname">_set_non_base_scheduled_arrival</code><span class="sig-paren">(</span><em>lanes</em>, <em>scheduled_arrivals</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT._set_non_base_scheduled_arrival" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the scheduled departure in the trajectory of the vehicle.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Departure schedule of those which were served by base SPaT is set in <code class="docutils literal notranslate"><span class="pre">base_badness()</span></code> and not here.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lanes</strong> – </li>
<li><strong>scheduled_arrivals</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – by default the departure speed is maximum allowable speed in <span class="math notranslate nohighlight">\(m/s\)</span></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Enumerate_SpaT._set_phase_lane_incidence">
<code class="descname">_set_phase_lane_incidence</code><span class="sig-paren">(</span><em>num_lanes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT._set_phase_lane_incidence" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the phase-phase incidence matrix of the intersection
#todo automate phase enumerator
:param num_lanes:
:return:</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Enumerate_SpaT.append_extend_phase">
<code class="descname">append_extend_phase</code><span class="sig-paren">(</span><em>phase</em>, <em>actual_green</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT.append_extend_phase" title="Permalink to this definition">¶</a></dt>
<dd><p>Append a phase to the SPaT (append a phase and its green to the end of signal array)
Note SPaT decision is the sequence and green duration of phases</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>phase</strong> – phase to be added</li>
<li><strong>actual_green</strong> – green duration of that phase</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Enumerate_SpaT.base_badness">
<code class="descname">base_badness</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT.base_badness" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>This method aims to serve as many vehicles as possible given the available SPaT. Depending on the signal method,</dt>
<dd><p class="first">the set of current SPaT could be different. For example:</p>
<blockquote class="last">
<div><ul class="simple">
<li><dl class="first docutils">
<dt>If called by <code class="docutils literal notranslate"><span class="pre">Pretimed()</span></code> solver, the current SPaT may include multiple phases as Pretimed SPaT never</dt>
<dd>gets flushed.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If called by <code class="docutils literal notranslate"><span class="pre">GA_SPaT()</span></code> solver, since the SPaT gets flushed before calling. The goal is to serve as</dt>
<dd>many vehicles with only the single current phase in SPaT.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd>
<dt>The condition to be served is to meet the following criteria:</dt>
<dd><ul class="first last simple">
<li>Respect the minimum headway to the lead vehicle (if present)</li>
<li>Respect the initiation of green plus a lag time specified by LAG as a class variable</li>
<li>Respect the earliest available time at the stop bar controlled by the speed limit  acc/dec rates</li>
<li>Vehicle is allowed to acquire a new trajectory (<code class="docutils literal notranslate"><span class="pre">veh.redo_trj_allowed</span></code> holds True)</li>
</ul>
</dd>
</dl>
<p>The method does not compute or return the badness metric since the it does not aim to change current phase and
timing.</p>
<p>It may only gets called once per each Signal solve call prior to computation of the new SPaTs.</p>
<dl class="docutils">
<dt>The schedule keeps the earliest departures at the stop bars of each lane and gets updated when a signal decision</dt>
<dd>goes permanent. It is made by a dictionary of arrays (key is lane, value is sorted earliest departures).</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> and setting the schedule of any possible served vehicles make the main result of this
method. The <code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> will be used after this to avoid reserving and double-counting those
already served with base SPaT. This also returns <code class="docutils literal notranslate"><span class="pre">any_unserved_vehicle</span></code> array that has True if any lane has
vehicles that could not be unserved with base SPaT.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Since base SPaT never gets changed (for safety and practical reasons), any vehicle served by it has to get <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> value set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li>It is feasible that if fusion algorithm updates the info on this vehicle and wants an update on trajectory, it rolls back the <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> to be <code class="docutils literal notranslate"><span class="pre">True</span></code>. However, this should be decided outside this method.</li>
<li>The reason that this does not return schedule of departures is because they are already set inside this method. Late, the set method skips these.</li>
<li>If a vehicle gets a schedule and has more than one trajectory point, the last index should reset to the first index so when the trajectory is set there would be two points.</li>
<li>all-red from the end and <code class="docutils literal notranslate"><span class="pre">LAG</span></code> time from the beginning of a phase are note utilizes by any vehicle.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The <code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> array that keeps index off the first unserved vehicle in each lane, is</p>
</td>
</tr>
</tbody>
</table>
<p>initialized to zero before calling this method and gets updated by the end of this call. It also returns
<code class="docutils literal notranslate"><span class="pre">served_vehicle_time</span></code> that shows the schedule</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Enumerate_SpaT.flush_upcoming_SPaT">
<code class="descname">flush_upcoming_SPaT</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT.flush_upcoming_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><p>Just leaves the first SPaT and flushes the rest
# todo maybe reduce the green time of first phase too?
:return:</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Enumerate_SpaT.set_critical_phase_volumes">
<code class="descname">set_critical_phase_volumes</code><span class="sig-paren">(</span><em>volumes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT.set_critical_phase_volumes" title="Permalink to this definition">¶</a></dt>
<dd><p>Not used in GA since the phasing configuration is unknown prior to cycle length formula
that is derived from time budget concept</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not call this on a signal method that does not take <code class="docutils literal notranslate"><span class="pre">allowable_phases</span></code> as input</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>volumes</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Enumerate_SpaT.solve">
<code class="descname">solve</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>allowable_phases</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Enumerate_SpaT.solve"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT.solve" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="src.inter.signal.Enumerate_SpaT.update_SPaT">
<code class="descname">update_SPaT</code><span class="sig-paren">(</span><em>time_threshold</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Enumerate_SpaT.update_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Performs two tasks to update SPaT based on the given clock:</dt>
<dd><ul class="first last simple">
<li>Removes terminated phase (happens when the all-red is passed)</li>
<li>Checks for  SPaT to not get empty after being updated</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>If all phases are getting purged, either make longer SPaT decisions or reduce the simulation steps.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>time_threshold</strong> – Normally the current clock of simulation or real-time in <span class="math notranslate nohighlight">\(s\)</span></td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="src.inter.signal.GA_SPaT">
<em class="property">class </em><code class="descclassname">src.inter.signal.</code><code class="descname">GA_SPaT</code><span class="sig-paren">(</span><em>inter_name</em>, <em>allowable_phases</em>, <em>num_lanes</em>, <em>min_headway</em>, <em>print_signal_detail</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#GA_SPaT"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.GA_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#src.inter.signal.Signal" title="src.inter.signal.Signal"><code class="xref py py-class docutils literal notranslate"><span class="pre">src.inter.signal.Signal</span></code></a></p>
<dl class="docutils">
<dt>Assumptions:</dt>
<dd><ul class="first last simple">
<li>The sequence and duration is decided optimally by a Genetic Algorithms</li>
<li><dl class="first docutils">
<dt>The trajectories are computed using:</dt>
<dd><ul class="first last">
<li>Gipps car following model for conventional vehicles</li>
<li>Polynomial degree k area under curve minimization for Lead/Follower AVs</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>allowable_phases</strong> – subset of all possible phases is used (no limitation but it should cover all movements)</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">allowable_phases</span></code> should be zero-based unlike what is provided in <code class="docutils literal notranslate"><span class="pre">data.py</span></code></p>
</div>
<dl class="attribute">
<dt id="src.inter.signal.GA_SPaT.ACCURACY_OF_BADNESS_MEASURE">
<code class="descname">ACCURACY_OF_BADNESS_MEASURE</code><em class="property"> = 100</em><a class="headerlink" href="#src.inter.signal.GA_SPaT.ACCURACY_OF_BADNESS_MEASURE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.GA_SPaT.CROSSOVER_SIZE">
<code class="descname">CROSSOVER_SIZE</code><em class="property"> = 10</em><a class="headerlink" href="#src.inter.signal.GA_SPaT.CROSSOVER_SIZE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.GA_SPaT.LAG">
<code class="descname">LAG</code><em class="property"> = 1</em><a class="headerlink" href="#src.inter.signal.GA_SPaT.LAG" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.GA_SPaT.LARGE_NUM">
<code class="descname">LARGE_NUM</code><em class="property"> = 999999</em><a class="headerlink" href="#src.inter.signal.GA_SPaT.LARGE_NUM" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.GA_SPaT.MAX_ITERATION_PER_PHASE">
<code class="descname">MAX_ITERATION_PER_PHASE</code><em class="property"> = 10</em><a class="headerlink" href="#src.inter.signal.GA_SPaT.MAX_ITERATION_PER_PHASE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.GA_SPaT.MAX_PHASE_LENGTH">
<code class="descname">MAX_PHASE_LENGTH</code><em class="property"> = 5</em><a class="headerlink" href="#src.inter.signal.GA_SPaT.MAX_PHASE_LENGTH" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.GA_SPaT.POPULATION_SIZE">
<code class="descname">POPULATION_SIZE</code><em class="property"> = 20</em><a class="headerlink" href="#src.inter.signal.GA_SPaT.POPULATION_SIZE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT._schedule_unserved_vehicles">
<code class="descname">_schedule_unserved_vehicles</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>served_vehicle_time</em>, <em>any_unserved_vehicle</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.GA_SPaT._schedule_unserved_vehicles" title="Permalink to this definition">¶</a></dt>
<dd><p>Sometimes the base SPaT prior to running a <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method does not serve all vehicles. However, vehicles
require trajectory to be provided. One way to address this is to assign them the best temporal trajectory which
only has some of general qualities necessary for continuation of program. In this method we do the followings
to compute the <code class="docutils literal notranslate"><span class="pre">departure</span> <span class="pre">times</span></code> of such trajectories:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>Without use of phases, schedule vehicles one after the other at minimum headway restricted by the</dt>
<dd>saturation headway. This gives an overestimate of teh departure time since one vehicle gets served by
intersection at a time, while having allowing to depart in phases let multiple simultaneous departures.</dd>
</dl>
</li>
<li>This may be called after a signal <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method decided to complete those that did not get served.</li>
<li>Also this assumes min headway after green starts instead of <code class="docutils literal notranslate"><span class="pre">LAG</span></code> time which is a simplification.</li>
<li><dl class="first docutils">
<dt>If a vehicle gets a schedule and has more than one trajectory point, the last index should reset to the</dt>
<dd>first index so when the trajectory is set there would be two points.</dd>
</dl>
</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since the departure times are definitely temporal, DO NOT set <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>served_vehicle_time</strong> – includes schedule of departures for those served by base SPaT</li>
<li><strong>any_unserved_vehicle</strong> – <cite>Has `False`</cite> for the lane that has all vehicles scheduled through base SPaT and the <code class="docutils literal notranslate"><span class="pre">solve()</span></code>, <code class="docutils literal notranslate"><span class="pre">True</span></code> otherwise.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><code class="docutils literal notranslate"><span class="pre">served_vehicle_time</span></code> that now includes the schedules of all vehicle except those served through base SPaT</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT._set_lane_lane_incidence">
<code class="descname">_set_lane_lane_incidence</code><span class="sig-paren">(</span><em>num_lanes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.GA_SPaT._set_lane_lane_incidence" title="Permalink to this definition">¶</a></dt>
<dd><p>This converts a dictionary of the form:
key is a lane and value is <em>set</em> of lanes that are in conflict with key (note numbering starts from 1 not 0)
to <code class="docutils literal notranslate"><span class="pre">lane_lane_incidence</span></code> which includes the conflict matrix <span class="math notranslate nohighlight">\(|L|*|L|\)</span> where element <span class="math notranslate nohighlight">\(ij\)</span>
is 1 if <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> are
conflicting movements</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>num_lanes</strong> – </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT._set_non_base_scheduled_arrival">
<code class="descname">_set_non_base_scheduled_arrival</code><span class="sig-paren">(</span><em>lanes</em>, <em>scheduled_arrivals</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.GA_SPaT._set_non_base_scheduled_arrival" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the scheduled departure in the trajectory of the vehicle.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Departure schedule of those which were served by base SPaT is set in <code class="docutils literal notranslate"><span class="pre">base_badness()</span></code> and not here.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lanes</strong> – </li>
<li><strong>scheduled_arrivals</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – by default the departure speed is maximum allowable speed in <span class="math notranslate nohighlight">\(m/s\)</span></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT._set_phase_lane_incidence">
<code class="descname">_set_phase_lane_incidence</code><span class="sig-paren">(</span><em>num_lanes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.GA_SPaT._set_phase_lane_incidence" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the phase-phase incidence matrix of the intersection
#todo automate phase enumerator
:param num_lanes:
:return:</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT.append_extend_phase">
<code class="descname">append_extend_phase</code><span class="sig-paren">(</span><em>phase</em>, <em>actual_green</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.GA_SPaT.append_extend_phase" title="Permalink to this definition">¶</a></dt>
<dd><p>Append a phase to the SPaT (append a phase and its green to the end of signal array)
Note SPaT decision is the sequence and green duration of phases</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>phase</strong> – phase to be added</li>
<li><strong>actual_green</strong> – green duration of that phase</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT.base_badness">
<code class="descname">base_badness</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.GA_SPaT.base_badness" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>This method aims to serve as many vehicles as possible given the available SPaT. Depending on the signal method,</dt>
<dd><p class="first">the set of current SPaT could be different. For example:</p>
<blockquote class="last">
<div><ul class="simple">
<li><dl class="first docutils">
<dt>If called by <code class="docutils literal notranslate"><span class="pre">Pretimed()</span></code> solver, the current SPaT may include multiple phases as Pretimed SPaT never</dt>
<dd>gets flushed.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If called by <code class="docutils literal notranslate"><span class="pre">GA_SPaT()</span></code> solver, since the SPaT gets flushed before calling. The goal is to serve as</dt>
<dd>many vehicles with only the single current phase in SPaT.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd>
<dt>The condition to be served is to meet the following criteria:</dt>
<dd><ul class="first last simple">
<li>Respect the minimum headway to the lead vehicle (if present)</li>
<li>Respect the initiation of green plus a lag time specified by LAG as a class variable</li>
<li>Respect the earliest available time at the stop bar controlled by the speed limit  acc/dec rates</li>
<li>Vehicle is allowed to acquire a new trajectory (<code class="docutils literal notranslate"><span class="pre">veh.redo_trj_allowed</span></code> holds True)</li>
</ul>
</dd>
</dl>
<p>The method does not compute or return the badness metric since the it does not aim to change current phase and
timing.</p>
<p>It may only gets called once per each Signal solve call prior to computation of the new SPaTs.</p>
<dl class="docutils">
<dt>The schedule keeps the earliest departures at the stop bars of each lane and gets updated when a signal decision</dt>
<dd>goes permanent. It is made by a dictionary of arrays (key is lane, value is sorted earliest departures).</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> and setting the schedule of any possible served vehicles make the main result of this
method. The <code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> will be used after this to avoid reserving and double-counting those
already served with base SPaT. This also returns <code class="docutils literal notranslate"><span class="pre">any_unserved_vehicle</span></code> array that has True if any lane has
vehicles that could not be unserved with base SPaT.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Since base SPaT never gets changed (for safety and practical reasons), any vehicle served by it has to get <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> value set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li>It is feasible that if fusion algorithm updates the info on this vehicle and wants an update on trajectory, it rolls back the <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> to be <code class="docutils literal notranslate"><span class="pre">True</span></code>. However, this should be decided outside this method.</li>
<li>The reason that this does not return schedule of departures is because they are already set inside this method. Late, the set method skips these.</li>
<li>If a vehicle gets a schedule and has more than one trajectory point, the last index should reset to the first index so when the trajectory is set there would be two points.</li>
<li>all-red from the end and <code class="docutils literal notranslate"><span class="pre">LAG</span></code> time from the beginning of a phase are note utilizes by any vehicle.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The <code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> array that keeps index off the first unserved vehicle in each lane, is</p>
</td>
</tr>
</tbody>
</table>
<p>initialized to zero before calling this method and gets updated by the end of this call. It also returns
<code class="docutils literal notranslate"><span class="pre">served_vehicle_time</span></code> that shows the schedule</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT.cross_over">
<code class="descname">cross_over</code><span class="sig-paren">(</span><em>left_parent</em>, <em>right_parent</em>, <em>phase_length</em>, <em>half_max_indx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#GA_SPaT.cross_over"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.GA_SPaT.cross_over" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>left_parent</strong> – </li>
<li><strong>right_parent</strong> – </li>
<li><strong>phase_length</strong> – </li>
<li><strong>half_max_indx</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT.evaluate_badness">
<code class="descname">evaluate_badness</code><span class="sig-paren">(</span><em>phase_seq</em>, <em>time_split</em>, <em>lanes</em>, <em>num_lanes</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#GA_SPaT.evaluate_badness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.GA_SPaT.evaluate_badness" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>phase_seq</strong> – </li>
<li><strong>time_split</strong> – </li>
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT.flush_upcoming_SPaT">
<code class="descname">flush_upcoming_SPaT</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.GA_SPaT.flush_upcoming_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><p>Just leaves the first SPaT and flushes the rest
# todo maybe reduce the green time of first phase too?
:return:</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT.get_optimal_cycle_length">
<code class="descname">get_optimal_cycle_length</code><span class="sig-paren">(</span><em>critical_volume_ratio</em>, <em>phase_length</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#GA_SPaT.get_optimal_cycle_length"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.GA_SPaT.get_optimal_cycle_length" title="Permalink to this definition">¶</a></dt>
<dd><p>Uses the time budget concept <span class="math notranslate nohighlight">\(C=(n*ar)/(1-V_{cr})\)</span>.</p>
<p>Refer to HCM 2010 for values.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>critical_volume_ratio</strong> – </li>
<li><strong>phase_length</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT.mutate_seq">
<code class="descname">mutate_seq</code><span class="sig-paren">(</span><em>phase_length</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#GA_SPaT.mutate_seq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.GA_SPaT.mutate_seq" title="Permalink to this definition">¶</a></dt>
<dd><p>Randomize the sequence
# todo: if two same phases follow each other, re-sample carefully with replacement</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>phase_length</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT.mutate_timing">
<code class="descname">mutate_timing</code><span class="sig-paren">(</span><em>cycle_length</em>, <em>phase_length</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#GA_SPaT.mutate_timing"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.GA_SPaT.mutate_timing" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the random phase split
Valid timing should respect the min/max green requirement unless it conflicts with the
cycle length which in that case we should adjust the maximum green to avoid the slack
in time</p>
<p>note each timing is between <code class="docutils literal notranslate"><span class="pre">g_min+y+ar</span> <span class="pre">and</span> <span class="pre">g_max+y+ar</span></code></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cycle_length</strong> – </li>
<li><strong>phase_length</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT.set_critical_phase_volumes">
<code class="descname">set_critical_phase_volumes</code><span class="sig-paren">(</span><em>volumes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.GA_SPaT.set_critical_phase_volumes" title="Permalink to this definition">¶</a></dt>
<dd><p>Not used in GA since the phasing configuration is unknown prior to cycle length formula
that is derived from time budget concept</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not call this on a signal method that does not take <code class="docutils literal notranslate"><span class="pre">allowable_phases</span></code> as input</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>volumes</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT.solve">
<code class="descname">solve</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>max_speed</em>, <em>critical_volume_ratio</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#GA_SPaT.solve"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.GA_SPaT.solve" title="Permalink to this definition">¶</a></dt>
<dd><p>This runs GA
the key to the sorted dict is integer part of the travel time times 10</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.GA_SPaT.update_SPaT">
<code class="descname">update_SPaT</code><span class="sig-paren">(</span><em>time_threshold</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.GA_SPaT.update_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Performs two tasks to update SPaT based on the given clock:</dt>
<dd><ul class="first last simple">
<li>Removes terminated phase (happens when the all-red is passed)</li>
<li>Checks for  SPaT to not get empty after being updated</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>If all phases are getting purged, either make longer SPaT decisions or reduce the simulation steps.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>time_threshold</strong> – Normally the current clock of simulation or real-time in <span class="math notranslate nohighlight">\(s\)</span></td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="src.inter.signal.MinCostFlow_SPaT">
<em class="property">class </em><code class="descclassname">src.inter.signal.</code><code class="descname">MinCostFlow_SPaT</code><span class="sig-paren">(</span><em>inter_name</em>, <em>allowable_phases</em>, <em>num_lanes</em>, <em>pli</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#MinCostFlow_SPaT"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#src.inter.signal.Signal" title="src.inter.signal.Signal"><code class="xref py py-class docutils literal notranslate"><span class="pre">src.inter.signal.Signal</span></code></a></p>
<p>This class is meant to slove the min cost flow problem that is set up for phase selection</p>
<p>Code is written in Python 3
Install the list of packages in the Pipfile using PyEnv</p>
<p>solver by Google: <a class="reference external" href="https://goo.gl/jFncvj">https://goo.gl/jFncvj</a></p>
<p>NODES:
Head of phase-selection arcs: from 0 to <a href="#id1"><span class="problematic" id="id2">|p|</span></a>-1
Head of sink arcs: from <a href="#id3"><span class="problematic" id="id4">|p|</span></a> to 2|p|-1
Head of lane-assignment arcs: from 2|p|+1 to 2|p|+|L|</p>
<p>ARCS:
Phase-selection arcs are from 0 to <a href="#id5"><span class="problematic" id="id6">|p|</span></a>-1</p>
<blockquote>
<div>cost 1 unit / cap of M</div></blockquote>
<dl class="docutils">
<dt>Phase-activator arcs are from <a href="#id7"><span class="problematic" id="id8">|p|</span></a> to 2|p|-1</dt>
<dd>cost 1 unit / cap of 1</dd>
<dt>Sink arcs are from 2|p| to 3|p|-1</dt>
<dd>cost 0 unit / cap of M</dd>
<dt>Lane-assignment arcs are from 3|p| to len(A)</dt>
<dd>cost 0 unit / cap of M</dd>
</dl>
<p>(Note M is the large constant implemented as self.M)</p>
<dl class="attribute">
<dt id="src.inter.signal.MinCostFlow_SPaT.CMIN">
<code class="descname">CMIN</code><em class="property"> = 1</em><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT.CMIN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.MinCostFlow_SPaT.LAG">
<code class="descname">LAG</code><em class="property"> = 1</em><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT.LAG" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.MinCostFlow_SPaT.LARGE_NUM">
<code class="descname">LARGE_NUM</code><em class="property"> = 999999</em><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT.LARGE_NUM" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.MinCostFlow_SPaT.M">
<code class="descname">M</code><em class="property"> = 999</em><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT.M" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="src.inter.signal.MinCostFlow_SPaT._schedule_unserved_vehicles">
<code class="descname">_schedule_unserved_vehicles</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>served_vehicle_time</em>, <em>any_unserved_vehicle</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT._schedule_unserved_vehicles" title="Permalink to this definition">¶</a></dt>
<dd><p>Sometimes the base SPaT prior to running a <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method does not serve all vehicles. However, vehicles
require trajectory to be provided. One way to address this is to assign them the best temporal trajectory which
only has some of general qualities necessary for continuation of program. In this method we do the followings
to compute the <code class="docutils literal notranslate"><span class="pre">departure</span> <span class="pre">times</span></code> of such trajectories:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>Without use of phases, schedule vehicles one after the other at minimum headway restricted by the</dt>
<dd>saturation headway. This gives an overestimate of teh departure time since one vehicle gets served by
intersection at a time, while having allowing to depart in phases let multiple simultaneous departures.</dd>
</dl>
</li>
<li>This may be called after a signal <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method decided to complete those that did not get served.</li>
<li>Also this assumes min headway after green starts instead of <code class="docutils literal notranslate"><span class="pre">LAG</span></code> time which is a simplification.</li>
<li><dl class="first docutils">
<dt>If a vehicle gets a schedule and has more than one trajectory point, the last index should reset to the</dt>
<dd>first index so when the trajectory is set there would be two points.</dd>
</dl>
</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since the departure times are definitely temporal, DO NOT set <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>served_vehicle_time</strong> – includes schedule of departures for those served by base SPaT</li>
<li><strong>any_unserved_vehicle</strong> – <cite>Has `False`</cite> for the lane that has all vehicles scheduled through base SPaT and the <code class="docutils literal notranslate"><span class="pre">solve()</span></code>, <code class="docutils literal notranslate"><span class="pre">True</span></code> otherwise.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><code class="docutils literal notranslate"><span class="pre">served_vehicle_time</span></code> that now includes the schedules of all vehicle except those served through base SPaT</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.MinCostFlow_SPaT._set_lane_lane_incidence">
<code class="descname">_set_lane_lane_incidence</code><span class="sig-paren">(</span><em>num_lanes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT._set_lane_lane_incidence" title="Permalink to this definition">¶</a></dt>
<dd><p>This converts a dictionary of the form:
key is a lane and value is <em>set</em> of lanes that are in conflict with key (note numbering starts from 1 not 0)
to <code class="docutils literal notranslate"><span class="pre">lane_lane_incidence</span></code> which includes the conflict matrix <span class="math notranslate nohighlight">\(|L|*|L|\)</span> where element <span class="math notranslate nohighlight">\(ij\)</span>
is 1 if <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> are
conflicting movements</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>num_lanes</strong> – </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.MinCostFlow_SPaT._set_non_base_scheduled_arrival">
<code class="descname">_set_non_base_scheduled_arrival</code><span class="sig-paren">(</span><em>lanes</em>, <em>scheduled_arrivals</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT._set_non_base_scheduled_arrival" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the scheduled departure in the trajectory of the vehicle.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Departure schedule of those which were served by base SPaT is set in <code class="docutils literal notranslate"><span class="pre">base_badness()</span></code> and not here.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lanes</strong> – </li>
<li><strong>scheduled_arrivals</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – by default the departure speed is maximum allowable speed in <span class="math notranslate nohighlight">\(m/s\)</span></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.MinCostFlow_SPaT._set_phase_lane_incidence">
<code class="descname">_set_phase_lane_incidence</code><span class="sig-paren">(</span><em>num_lanes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT._set_phase_lane_incidence" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the phase-phase incidence matrix of the intersection
#todo automate phase enumerator
:param num_lanes:
:return:</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.MinCostFlow_SPaT.append_extend_phase">
<code class="descname">append_extend_phase</code><span class="sig-paren">(</span><em>phase</em>, <em>actual_green</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT.append_extend_phase" title="Permalink to this definition">¶</a></dt>
<dd><p>Append a phase to the SPaT (append a phase and its green to the end of signal array)
Note SPaT decision is the sequence and green duration of phases</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>phase</strong> – phase to be added</li>
<li><strong>actual_green</strong> – green duration of that phase</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.MinCostFlow_SPaT.base_badness">
<code class="descname">base_badness</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT.base_badness" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>This method aims to serve as many vehicles as possible given the available SPaT. Depending on the signal method,</dt>
<dd><p class="first">the set of current SPaT could be different. For example:</p>
<blockquote class="last">
<div><ul class="simple">
<li><dl class="first docutils">
<dt>If called by <code class="docutils literal notranslate"><span class="pre">Pretimed()</span></code> solver, the current SPaT may include multiple phases as Pretimed SPaT never</dt>
<dd>gets flushed.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If called by <code class="docutils literal notranslate"><span class="pre">GA_SPaT()</span></code> solver, since the SPaT gets flushed before calling. The goal is to serve as</dt>
<dd>many vehicles with only the single current phase in SPaT.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd>
<dt>The condition to be served is to meet the following criteria:</dt>
<dd><ul class="first last simple">
<li>Respect the minimum headway to the lead vehicle (if present)</li>
<li>Respect the initiation of green plus a lag time specified by LAG as a class variable</li>
<li>Respect the earliest available time at the stop bar controlled by the speed limit  acc/dec rates</li>
<li>Vehicle is allowed to acquire a new trajectory (<code class="docutils literal notranslate"><span class="pre">veh.redo_trj_allowed</span></code> holds True)</li>
</ul>
</dd>
</dl>
<p>The method does not compute or return the badness metric since the it does not aim to change current phase and
timing.</p>
<p>It may only gets called once per each Signal solve call prior to computation of the new SPaTs.</p>
<dl class="docutils">
<dt>The schedule keeps the earliest departures at the stop bars of each lane and gets updated when a signal decision</dt>
<dd>goes permanent. It is made by a dictionary of arrays (key is lane, value is sorted earliest departures).</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> and setting the schedule of any possible served vehicles make the main result of this
method. The <code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> will be used after this to avoid reserving and double-counting those
already served with base SPaT. This also returns <code class="docutils literal notranslate"><span class="pre">any_unserved_vehicle</span></code> array that has True if any lane has
vehicles that could not be unserved with base SPaT.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Since base SPaT never gets changed (for safety and practical reasons), any vehicle served by it has to get <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> value set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li>It is feasible that if fusion algorithm updates the info on this vehicle and wants an update on trajectory, it rolls back the <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> to be <code class="docutils literal notranslate"><span class="pre">True</span></code>. However, this should be decided outside this method.</li>
<li>The reason that this does not return schedule of departures is because they are already set inside this method. Late, the set method skips these.</li>
<li>If a vehicle gets a schedule and has more than one trajectory point, the last index should reset to the first index so when the trajectory is set there would be two points.</li>
<li>all-red from the end and <code class="docutils literal notranslate"><span class="pre">LAG</span></code> time from the beginning of a phase are note utilizes by any vehicle.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The <code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> array that keeps index off the first unserved vehicle in each lane, is</p>
</td>
</tr>
</tbody>
</table>
<p>initialized to zero before calling this method and gets updated by the end of this call. It also returns
<code class="docutils literal notranslate"><span class="pre">served_vehicle_time</span></code> that shows the schedule</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.MinCostFlow_SPaT.flush_upcoming_SPaT">
<code class="descname">flush_upcoming_SPaT</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT.flush_upcoming_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><p>Just leaves the first SPaT and flushes the rest
# todo maybe reduce the green time of first phase too?
:return:</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.MinCostFlow_SPaT.set_critical_phase_volumes">
<code class="descname">set_critical_phase_volumes</code><span class="sig-paren">(</span><em>volumes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT.set_critical_phase_volumes" title="Permalink to this definition">¶</a></dt>
<dd><p>Not used in GA since the phasing configuration is unknown prior to cycle length formula
that is derived from time budget concept</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not call this on a signal method that does not take <code class="docutils literal notranslate"><span class="pre">allowable_phases</span></code> as input</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>volumes</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.MinCostFlow_SPaT.set_dem">
<code class="descname">set_dem</code><span class="sig-paren">(</span><em>lanes_demand</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#MinCostFlow_SPaT.set_dem"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT.set_dem" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="src.inter.signal.MinCostFlow_SPaT.solve">
<code class="descname">solve</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#MinCostFlow_SPaT.solve"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT.solve" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="src.inter.signal.MinCostFlow_SPaT.update_SPaT">
<code class="descname">update_SPaT</code><span class="sig-paren">(</span><em>time_threshold</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.MinCostFlow_SPaT.update_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Performs two tasks to update SPaT based on the given clock:</dt>
<dd><ul class="first last simple">
<li>Removes terminated phase (happens when the all-red is passed)</li>
<li>Checks for  SPaT to not get empty after being updated</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>If all phases are getting purged, either make longer SPaT decisions or reduce the simulation steps.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>time_threshold</strong> – Normally the current clock of simulation or real-time in <span class="math notranslate nohighlight">\(s\)</span></td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="src.inter.signal.Pretimed">
<em class="property">class </em><code class="descclassname">src.inter.signal.</code><code class="descname">Pretimed</code><span class="sig-paren">(</span><em>inter_name</em>, <em>num_lanes</em>, <em>min_headway</em>, <em>print_signal_detail</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Pretimed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Pretimed" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#src.inter.signal.Signal" title="src.inter.signal.Signal"><code class="xref py py-class docutils literal notranslate"><span class="pre">src.inter.signal.Signal</span></code></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<dl class="last docutils">
<dt>Assumptions:</dt>
<dd><ul class="first last simple">
<li>The sequence and duration are pre-determined</li>
<li><dl class="first docutils">
<dt>Cycle length is computed using the time budget concept in traffic flow theory</dt>
<dd><ul class="first last">
<li>min and max of 60 and 120 seconds bound the <em>cycle length</em></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Must choose <code class="docutils literal notranslate"><span class="pre">NUM_CYCLES</span></code> at least 2.</p>
</div>
<dl class="attribute">
<dt id="src.inter.signal.Pretimed.LAG">
<code class="descname">LAG</code><em class="property"> = 1</em><a class="headerlink" href="#src.inter.signal.Pretimed.LAG" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.Pretimed.LARGE_NUM">
<code class="descname">LARGE_NUM</code><em class="property"> = 999999</em><a class="headerlink" href="#src.inter.signal.Pretimed.LARGE_NUM" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.Pretimed.NUM_CYCLES">
<code class="descname">NUM_CYCLES</code><em class="property"> = 2</em><a class="headerlink" href="#src.inter.signal.Pretimed.NUM_CYCLES" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="src.inter.signal.Pretimed._schedule_unserved_vehicles">
<code class="descname">_schedule_unserved_vehicles</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>served_vehicle_time</em>, <em>any_unserved_vehicle</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Pretimed._schedule_unserved_vehicles" title="Permalink to this definition">¶</a></dt>
<dd><p>Sometimes the base SPaT prior to running a <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method does not serve all vehicles. However, vehicles
require trajectory to be provided. One way to address this is to assign them the best temporal trajectory which
only has some of general qualities necessary for continuation of program. In this method we do the followings
to compute the <code class="docutils literal notranslate"><span class="pre">departure</span> <span class="pre">times</span></code> of such trajectories:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>Without use of phases, schedule vehicles one after the other at minimum headway restricted by the</dt>
<dd>saturation headway. This gives an overestimate of teh departure time since one vehicle gets served by
intersection at a time, while having allowing to depart in phases let multiple simultaneous departures.</dd>
</dl>
</li>
<li>This may be called after a signal <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method decided to complete those that did not get served.</li>
<li>Also this assumes min headway after green starts instead of <code class="docutils literal notranslate"><span class="pre">LAG</span></code> time which is a simplification.</li>
<li><dl class="first docutils">
<dt>If a vehicle gets a schedule and has more than one trajectory point, the last index should reset to the</dt>
<dd>first index so when the trajectory is set there would be two points.</dd>
</dl>
</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since the departure times are definitely temporal, DO NOT set <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>served_vehicle_time</strong> – includes schedule of departures for those served by base SPaT</li>
<li><strong>any_unserved_vehicle</strong> – <cite>Has `False`</cite> for the lane that has all vehicles scheduled through base SPaT and the <code class="docutils literal notranslate"><span class="pre">solve()</span></code>, <code class="docutils literal notranslate"><span class="pre">True</span></code> otherwise.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><code class="docutils literal notranslate"><span class="pre">served_vehicle_time</span></code> that now includes the schedules of all vehicle except those served through base SPaT</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Pretimed._set_lane_lane_incidence">
<code class="descname">_set_lane_lane_incidence</code><span class="sig-paren">(</span><em>num_lanes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Pretimed._set_lane_lane_incidence" title="Permalink to this definition">¶</a></dt>
<dd><p>This converts a dictionary of the form:
key is a lane and value is <em>set</em> of lanes that are in conflict with key (note numbering starts from 1 not 0)
to <code class="docutils literal notranslate"><span class="pre">lane_lane_incidence</span></code> which includes the conflict matrix <span class="math notranslate nohighlight">\(|L|*|L|\)</span> where element <span class="math notranslate nohighlight">\(ij\)</span>
is 1 if <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> are
conflicting movements</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>num_lanes</strong> – </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Pretimed._set_non_base_scheduled_arrival">
<code class="descname">_set_non_base_scheduled_arrival</code><span class="sig-paren">(</span><em>lanes</em>, <em>scheduled_arrivals</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Pretimed._set_non_base_scheduled_arrival" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the scheduled departure in the trajectory of the vehicle.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Departure schedule of those which were served by base SPaT is set in <code class="docutils literal notranslate"><span class="pre">base_badness()</span></code> and not here.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lanes</strong> – </li>
<li><strong>scheduled_arrivals</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – by default the departure speed is maximum allowable speed in <span class="math notranslate nohighlight">\(m/s\)</span></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Pretimed._set_phase_lane_incidence">
<code class="descname">_set_phase_lane_incidence</code><span class="sig-paren">(</span><em>num_lanes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Pretimed._set_phase_lane_incidence" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the phase-phase incidence matrix of the intersection
#todo automate phase enumerator
:param num_lanes:
:return:</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Pretimed.append_extend_phase">
<code class="descname">append_extend_phase</code><span class="sig-paren">(</span><em>phase</em>, <em>actual_green</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Pretimed.append_extend_phase" title="Permalink to this definition">¶</a></dt>
<dd><p>Append a phase to the SPaT (append a phase and its green to the end of signal array)
Note SPaT decision is the sequence and green duration of phases</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>phase</strong> – phase to be added</li>
<li><strong>actual_green</strong> – green duration of that phase</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Pretimed.base_badness">
<code class="descname">base_badness</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Pretimed.base_badness" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>This method aims to serve as many vehicles as possible given the available SPaT. Depending on the signal method,</dt>
<dd><p class="first">the set of current SPaT could be different. For example:</p>
<blockquote class="last">
<div><ul class="simple">
<li><dl class="first docutils">
<dt>If called by <code class="docutils literal notranslate"><span class="pre">Pretimed()</span></code> solver, the current SPaT may include multiple phases as Pretimed SPaT never</dt>
<dd>gets flushed.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If called by <code class="docutils literal notranslate"><span class="pre">GA_SPaT()</span></code> solver, since the SPaT gets flushed before calling. The goal is to serve as</dt>
<dd>many vehicles with only the single current phase in SPaT.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd>
<dt>The condition to be served is to meet the following criteria:</dt>
<dd><ul class="first last simple">
<li>Respect the minimum headway to the lead vehicle (if present)</li>
<li>Respect the initiation of green plus a lag time specified by LAG as a class variable</li>
<li>Respect the earliest available time at the stop bar controlled by the speed limit  acc/dec rates</li>
<li>Vehicle is allowed to acquire a new trajectory (<code class="docutils literal notranslate"><span class="pre">veh.redo_trj_allowed</span></code> holds True)</li>
</ul>
</dd>
</dl>
<p>The method does not compute or return the badness metric since the it does not aim to change current phase and
timing.</p>
<p>It may only gets called once per each Signal solve call prior to computation of the new SPaTs.</p>
<dl class="docutils">
<dt>The schedule keeps the earliest departures at the stop bars of each lane and gets updated when a signal decision</dt>
<dd>goes permanent. It is made by a dictionary of arrays (key is lane, value is sorted earliest departures).</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> and setting the schedule of any possible served vehicles make the main result of this
method. The <code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> will be used after this to avoid reserving and double-counting those
already served with base SPaT. This also returns <code class="docutils literal notranslate"><span class="pre">any_unserved_vehicle</span></code> array that has True if any lane has
vehicles that could not be unserved with base SPaT.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Since base SPaT never gets changed (for safety and practical reasons), any vehicle served by it has to get <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> value set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li>It is feasible that if fusion algorithm updates the info on this vehicle and wants an update on trajectory, it rolls back the <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> to be <code class="docutils literal notranslate"><span class="pre">True</span></code>. However, this should be decided outside this method.</li>
<li>The reason that this does not return schedule of departures is because they are already set inside this method. Late, the set method skips these.</li>
<li>If a vehicle gets a schedule and has more than one trajectory point, the last index should reset to the first index so when the trajectory is set there would be two points.</li>
<li>all-red from the end and <code class="docutils literal notranslate"><span class="pre">LAG</span></code> time from the beginning of a phase are note utilizes by any vehicle.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The <code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> array that keeps index off the first unserved vehicle in each lane, is</p>
</td>
</tr>
</tbody>
</table>
<p>initialized to zero before calling this method and gets updated by the end of this call. It also returns
<code class="docutils literal notranslate"><span class="pre">served_vehicle_time</span></code> that shows the schedule</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Pretimed.flush_upcoming_SPaT">
<code class="descname">flush_upcoming_SPaT</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Pretimed.flush_upcoming_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><p>Just leaves the first SPaT and flushes the rest
# todo maybe reduce the green time of first phase too?
:return:</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Pretimed.set_critical_phase_volumes">
<code class="descname">set_critical_phase_volumes</code><span class="sig-paren">(</span><em>volumes</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Pretimed.set_critical_phase_volumes" title="Permalink to this definition">¶</a></dt>
<dd><p>Not used in GA since the phasing configuration is unknown prior to cycle length formula
that is derived from time budget concept</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not call this on a signal method that does not take <code class="docutils literal notranslate"><span class="pre">allowable_phases</span></code> as input</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>volumes</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Pretimed.solve">
<code class="descname">solve</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Pretimed.solve"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Pretimed.solve" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>The phases sequence is exactly as the provided in <code class="docutils literal notranslate"><span class="pre">data.py</span></code>. The flow is:</dt>
<dd><ol class="first last arabic simple">
<li>First serves using the available SPaT</li>
<li>This simply adds a cycle to SPaT if a cycle is terminated</li>
<li>Serves unserved vehicles, if any present</li>
<li>Next it provides the departure schedule</li>
</ol>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">scheduled_departures</span></code> is made only to call <code class="docutils literal notranslate"><span class="pre">complete_unserved_vehicles()</span></code>. It only stores
departures for those vehicles nit served bt base SPaT.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Pretimed.update_SPaT">
<code class="descname">update_SPaT</code><span class="sig-paren">(</span><em>time_threshold</em><span class="sig-paren">)</span><a class="headerlink" href="#src.inter.signal.Pretimed.update_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Performs two tasks to update SPaT based on the given clock:</dt>
<dd><ul class="first last simple">
<li>Removes terminated phase (happens when the all-red is passed)</li>
<li>Checks for  SPaT to not get empty after being updated</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>If all phases are getting purged, either make longer SPaT decisions or reduce the simulation steps.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>time_threshold</strong> – Normally the current clock of simulation or real-time in <span class="math notranslate nohighlight">\(s\)</span></td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="src.inter.signal.Signal">
<em class="property">class </em><code class="descclassname">src.inter.signal.</code><code class="descname">Signal</code><span class="sig-paren">(</span><em>inter_name</em>, <em>num_lanes</em>, <em>min_headway</em>, <em>print_signal_detail</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Signal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Signal" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<blockquote>
<div><dl class="docutils">
<dt>The class serves the following goals:</dt>
<dd><ul class="first last simple">
<li>Keeps the SPaT decision updated</li>
<li><dl class="first docutils">
<dt>Makes SPaT decisions through variety of control methods. For now it supports:</dt>
<dd><ul class="first last">
<li>Pre-timed control</li>
<li>Genetic Algorithm</li>
<li>Min Cost Flow model</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p>Set the class variable <code class="docutils literal notranslate"><span class="pre">LAG</span></code> to the time (in seconds) that from start of green is not valid to schedule any
departurs.</p>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><code class="docutils literal notranslate"><span class="pre">LAG</span></code> also is used in <code class="docutils literal notranslate"><span class="pre">Trajectory()</span></code> class. Set them consistent.</li>
<li><code class="docutils literal notranslate"><span class="pre">LARGE_NUM</span></code> is a large number to initialize badness of alternatives in GA.</li>
</ul>
</div>
<dl class="attribute">
<dt id="src.inter.signal.Signal.LAG">
<code class="descname">LAG</code><em class="property"> = 1</em><a class="headerlink" href="#src.inter.signal.Signal.LAG" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="src.inter.signal.Signal.LARGE_NUM">
<code class="descname">LARGE_NUM</code><em class="property"> = 999999</em><a class="headerlink" href="#src.inter.signal.Signal.LARGE_NUM" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="src.inter.signal.Signal._schedule_unserved_vehicles">
<code class="descname">_schedule_unserved_vehicles</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>served_vehicle_time</em>, <em>any_unserved_vehicle</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Signal._schedule_unserved_vehicles"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Signal._schedule_unserved_vehicles" title="Permalink to this definition">¶</a></dt>
<dd><p>Sometimes the base SPaT prior to running a <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method does not serve all vehicles. However, vehicles
require trajectory to be provided. One way to address this is to assign them the best temporal trajectory which
only has some of general qualities necessary for continuation of program. In this method we do the followings
to compute the <code class="docutils literal notranslate"><span class="pre">departure</span> <span class="pre">times</span></code> of such trajectories:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>Without use of phases, schedule vehicles one after the other at minimum headway restricted by the</dt>
<dd>saturation headway. This gives an overestimate of teh departure time since one vehicle gets served by
intersection at a time, while having allowing to depart in phases let multiple simultaneous departures.</dd>
</dl>
</li>
<li>This may be called after a signal <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method decided to complete those that did not get served.</li>
<li>Also this assumes min headway after green starts instead of <code class="docutils literal notranslate"><span class="pre">LAG</span></code> time which is a simplification.</li>
<li><dl class="first docutils">
<dt>If a vehicle gets a schedule and has more than one trajectory point, the last index should reset to the</dt>
<dd>first index so when the trajectory is set there would be two points.</dd>
</dl>
</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since the departure times are definitely temporal, DO NOT set <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>served_vehicle_time</strong> – includes schedule of departures for those served by base SPaT</li>
<li><strong>any_unserved_vehicle</strong> – <cite>Has `False`</cite> for the lane that has all vehicles scheduled through base SPaT and the <code class="docutils literal notranslate"><span class="pre">solve()</span></code>, <code class="docutils literal notranslate"><span class="pre">True</span></code> otherwise.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><code class="docutils literal notranslate"><span class="pre">served_vehicle_time</span></code> that now includes the schedules of all vehicle except those served through base SPaT</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Signal._set_lane_lane_incidence">
<code class="descname">_set_lane_lane_incidence</code><span class="sig-paren">(</span><em>num_lanes</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Signal._set_lane_lane_incidence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Signal._set_lane_lane_incidence" title="Permalink to this definition">¶</a></dt>
<dd><p>This converts a dictionary of the form:
key is a lane and value is <em>set</em> of lanes that are in conflict with key (note numbering starts from 1 not 0)
to <code class="docutils literal notranslate"><span class="pre">lane_lane_incidence</span></code> which includes the conflict matrix <span class="math notranslate nohighlight">\(|L|*|L|\)</span> where element <span class="math notranslate nohighlight">\(ij\)</span>
is 1 if <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> are
conflicting movements</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>num_lanes</strong> – </td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Signal._set_non_base_scheduled_arrival">
<code class="descname">_set_non_base_scheduled_arrival</code><span class="sig-paren">(</span><em>lanes</em>, <em>scheduled_arrivals</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Signal._set_non_base_scheduled_arrival"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Signal._set_non_base_scheduled_arrival" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the scheduled departure in the trajectory of the vehicle.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Departure schedule of those which were served by base SPaT is set in <code class="docutils literal notranslate"><span class="pre">base_badness()</span></code> and not here.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lanes</strong> – </li>
<li><strong>scheduled_arrivals</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – by default the departure speed is maximum allowable speed in <span class="math notranslate nohighlight">\(m/s\)</span></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Signal._set_phase_lane_incidence">
<code class="descname">_set_phase_lane_incidence</code><span class="sig-paren">(</span><em>num_lanes</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Signal._set_phase_lane_incidence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Signal._set_phase_lane_incidence" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the phase-phase incidence matrix of the intersection
#todo automate phase enumerator
:param num_lanes:
:return:</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Signal.append_extend_phase">
<code class="descname">append_extend_phase</code><span class="sig-paren">(</span><em>phase</em>, <em>actual_green</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Signal.append_extend_phase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Signal.append_extend_phase" title="Permalink to this definition">¶</a></dt>
<dd><p>Append a phase to the SPaT (append a phase and its green to the end of signal array)
Note SPaT decision is the sequence and green duration of phases</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>phase</strong> – phase to be added</li>
<li><strong>actual_green</strong> – green duration of that phase</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Signal.base_badness">
<code class="descname">base_badness</code><span class="sig-paren">(</span><em>lanes</em>, <em>num_lanes</em>, <em>max_speed</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Signal.base_badness"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Signal.base_badness" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>This method aims to serve as many vehicles as possible given the available SPaT. Depending on the signal method,</dt>
<dd><p class="first">the set of current SPaT could be different. For example:</p>
<blockquote class="last">
<div><ul class="simple">
<li><dl class="first docutils">
<dt>If called by <code class="docutils literal notranslate"><span class="pre">Pretimed()</span></code> solver, the current SPaT may include multiple phases as Pretimed SPaT never</dt>
<dd>gets flushed.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If called by <code class="docutils literal notranslate"><span class="pre">GA_SPaT()</span></code> solver, since the SPaT gets flushed before calling. The goal is to serve as</dt>
<dd>many vehicles with only the single current phase in SPaT.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd>
<dt>The condition to be served is to meet the following criteria:</dt>
<dd><ul class="first last simple">
<li>Respect the minimum headway to the lead vehicle (if present)</li>
<li>Respect the initiation of green plus a lag time specified by LAG as a class variable</li>
<li>Respect the earliest available time at the stop bar controlled by the speed limit  acc/dec rates</li>
<li>Vehicle is allowed to acquire a new trajectory (<code class="docutils literal notranslate"><span class="pre">veh.redo_trj_allowed</span></code> holds True)</li>
</ul>
</dd>
</dl>
<p>The method does not compute or return the badness metric since the it does not aim to change current phase and
timing.</p>
<p>It may only gets called once per each Signal solve call prior to computation of the new SPaTs.</p>
<dl class="docutils">
<dt>The schedule keeps the earliest departures at the stop bars of each lane and gets updated when a signal decision</dt>
<dd>goes permanent. It is made by a dictionary of arrays (key is lane, value is sorted earliest departures).</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> and setting the schedule of any possible served vehicles make the main result of this
method. The <code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> will be used after this to avoid reserving and double-counting those
already served with base SPaT. This also returns <code class="docutils literal notranslate"><span class="pre">any_unserved_vehicle</span></code> array that has True if any lane has
vehicles that could not be unserved with base SPaT.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Since base SPaT never gets changed (for safety and practical reasons), any vehicle served by it has to get <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> value set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li>It is feasible that if fusion algorithm updates the info on this vehicle and wants an update on trajectory, it rolls back the <code class="docutils literal notranslate"><span class="pre">redo_trj_allowed</span></code> to be <code class="docutils literal notranslate"><span class="pre">True</span></code>. However, this should be decided outside this method.</li>
<li>The reason that this does not return schedule of departures is because they are already set inside this method. Late, the set method skips these.</li>
<li>If a vehicle gets a schedule and has more than one trajectory point, the last index should reset to the first index so when the trajectory is set there would be two points.</li>
<li>all-red from the end and <code class="docutils literal notranslate"><span class="pre">LAG</span></code> time from the beginning of a phase are note utilizes by any vehicle.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lanes</strong> – </li>
<li><strong>num_lanes</strong> – </li>
<li><strong>max_speed</strong> – </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The <code class="docutils literal notranslate"><span class="pre">self.first_unsrvd_indx</span></code> array that keeps index off the first unserved vehicle in each lane, is</p>
</td>
</tr>
</tbody>
</table>
<p>initialized to zero before calling this method and gets updated by the end of this call. It also returns
<code class="docutils literal notranslate"><span class="pre">served_vehicle_time</span></code> that shows the schedule</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Signal.flush_upcoming_SPaT">
<code class="descname">flush_upcoming_SPaT</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Signal.flush_upcoming_SPaT"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Signal.flush_upcoming_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><p>Just leaves the first SPaT and flushes the rest
# todo maybe reduce the green time of first phase too?
:return:</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Signal.set_critical_phase_volumes">
<code class="descname">set_critical_phase_volumes</code><span class="sig-paren">(</span><em>volumes</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Signal.set_critical_phase_volumes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Signal.set_critical_phase_volumes" title="Permalink to this definition">¶</a></dt>
<dd><p>Not used in GA since the phasing configuration is unknown prior to cycle length formula
that is derived from time budget concept</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not call this on a signal method that does not take <code class="docutils literal notranslate"><span class="pre">allowable_phases</span></code> as input</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>volumes</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.signal.Signal.update_SPaT">
<code class="descname">update_SPaT</code><span class="sig-paren">(</span><em>time_threshold</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/signal.html#Signal.update_SPaT"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.signal.Signal.update_SPaT" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Performs two tasks to update SPaT based on the given clock:</dt>
<dd><ul class="first last simple">
<li>Removes terminated phase (happens when the all-red is passed)</li>
<li>Checks for  SPaT to not get empty after being updated</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>If all phases are getting purged, either make longer SPaT decisions or reduce the simulation steps.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>time_threshold</strong> – Normally the current clock of simulation or real-time in <span class="math notranslate nohighlight">\(s\)</span></td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-src.inter.lane"></span><span class="target" id="module-src.inter.vehicle"></span><dl class="class">
<dt id="src.inter.vehicle.Vehicle">
<em class="property">class </em><code class="descclassname">src.inter.vehicle.</code><code class="descname">Vehicle</code><span class="sig-paren">(</span><em>det_id</em>, <em>det_type</em>, <em>det_time</em>, <em>speed</em>, <em>dist</em>, <em>des_speed</em>, <em>dest</em>, <em>length</em>, <em>amin</em>, <em>amax</em>, <em>indx</em>, <em>k</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/vehicle.html#Vehicle"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.vehicle.Vehicle" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Goals:
1) Defines the vehicle object that keeps all necessary information</p>
<blockquote>
<div>1-1) Those which are coming from fusion
1-2) Those which are defined to be decided in the program:
<cite>trajectory[time, distance, speed], earliest_arrival, scheduled_arrival, poly_coeffs, _do_trj</cite></div></blockquote>
<ol class="arabic simple" start="2">
<li>Update/record the trajectory points once they are expired</li>
<li>Keep trajectory indexes updated</li>
<li>Print useful info once a plan is scheduled</li>
<li>Decides if a trajectory re-computation is needed</li>
<li>Quality controls the assigned trajectory</li>
</ol>
</div></blockquote>
<dl class="docutils">
<dt>Note:</dt>
<dd><ol class="first last arabic simple">
<li>Make sure the MAX_NUM_TRAJECTORY_POINTS to preallocate the trajectories is enough for given problem</li>
</ol>
</dd>
</dl>
<dl class="staticmethod">
<dt id="src.inter.vehicle.Vehicle.map_veh_type2str">
<em class="property">static </em><code class="descname">map_veh_type2str</code><span class="sig-paren">(</span><em>code</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/vehicle.html#Vehicle.map_veh_type2str"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.vehicle.Vehicle.map_veh_type2str" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>For the purpose of printing, this method translates the vehicle codes. Currently, it supports:</dt>
<dd><ul class="first last simple">
<li>0 : Conventional Vehicle (<strong>CNV</strong>)</li>
<li>1 : Connected and Automated Vehicle (<strong>CAV</strong>)</li>
</ul>
</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>code</strong> (<em>int</em>) – numeric code for the vehicle type</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.vehicle.Vehicle.print_trj_points">
<code class="descname">print_trj_points</code><span class="sig-paren">(</span><em>lane</em>, <em>veh_indx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/vehicle.html#Vehicle.print_trj_points"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.vehicle.Vehicle.print_trj_points" title="Permalink to this definition">¶</a></dt>
<dd><p>Print the first and last trajectory points information.
This may be used either when a plan is scheduled or a trajectory is computed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lane</strong> – zero-based lane number</li>
<li><strong>veh_indx</strong> – index to find the vehicle in its lane array</li>
<li><strong>source</strong> – specifies which method has called the print</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.vehicle.Vehicle.reset_trj_points">
<code class="descname">reset_trj_points</code><span class="sig-paren">(</span><em>sc</em>, <em>lane</em>, <em>time_threshold</em>, <em>file</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/vehicle.html#Vehicle.reset_trj_points"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.vehicle.Vehicle.reset_trj_points" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes trajectory points in the csv file if their time stamp is before the <code class="docutils literal notranslate"><span class="pre">time_threshold</span></code> and then removes
them by updating the first trj point.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Before calling this make sure at least the first trajectory point’s time stamp is less than provided time
threshold or such a call would be pointless.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>sc</strong> – scenario number being simulated</li>
<li><strong>lane</strong> – lane number that is zero-based  (it records it one-based)</li>
<li><strong>time_threshold</strong> – any trajectory point before this is considered expired (normally its simulation time)</li>
<li><strong>file</strong> – initialized in <code class="docutils literal notranslate"><span class="pre">Traffic.__init__()</span></code> method, if <code class="docutils literal notranslate"><span class="pre">None</span></code>, this does not record points in csv.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.vehicle.Vehicle.set_earliest_arrival">
<code class="descname">set_earliest_arrival</code><span class="sig-paren">(</span><em>t_earliest</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/vehicle.html#Vehicle.set_earliest_arrival"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.vehicle.Vehicle.set_earliest_arrival" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the earliest arrival time at the stop bar
Called under Traffic.update_vehicles_info() method</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.vehicle.Vehicle.set_first_trj_point_indx">
<code class="descname">set_first_trj_point_indx</code><span class="sig-paren">(</span><em>indx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/vehicle.html#Vehicle.set_first_trj_point_indx"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.vehicle.Vehicle.set_first_trj_point_indx" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the fist column index that points to the trajectory start</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.vehicle.Vehicle.set_last_trj_point_indx">
<code class="descname">set_last_trj_point_indx</code><span class="sig-paren">(</span><em>indx</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/vehicle.html#Vehicle.set_last_trj_point_indx"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.vehicle.Vehicle.set_last_trj_point_indx" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the last column index that points to the trajectory start</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.vehicle.Vehicle.set_poly_coeffs">
<code class="descname">set_poly_coeffs</code><span class="sig-paren">(</span><em>beta</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/vehicle.html#Vehicle.set_poly_coeffs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.vehicle.Vehicle.set_poly_coeffs" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the coefficients that define the polynomial that defines trajectory of a connected vehicle</p>
</dd></dl>

<dl class="method">
<dt id="src.inter.vehicle.Vehicle.set_scheduled_arrival">
<code class="descname">set_scheduled_arrival</code><span class="sig-paren">(</span><em>t_scheduled</em>, <em>d_scheduled</em>, <em>s_scheduled</em>, <em>lane</em>, <em>veh_indx</em>, <em>print</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/vehicle.html#Vehicle.set_scheduled_arrival"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.vehicle.Vehicle.set_scheduled_arrival" title="Permalink to this definition">¶</a></dt>
<dd><div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>When a new vehicle is scheduled, it has two trajectory points: one for the current state and the other for the final state.</li>
<li>If the vehicle is closer than <code class="docutils literal notranslate"><span class="pre">MIN_DIST_TO_STOP_BAR</span></code>, avoid appending the schedule.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>t_scheduled</strong> – scheduled departure time (<span class="math notranslate nohighlight">\(s\)</span>)</li>
<li><strong>d_scheduled</strong> – scheduled departure distance (<span class="math notranslate nohighlight">\(m\)</span>)</li>
<li><strong>s_scheduled</strong> – scheduled departure speed (<span class="math notranslate nohighlight">\(m/s\)</span>)</li>
<li><strong>lane</strong> – the lane this vehicle is in (<em>for printing purpose only</em>)</li>
<li><strong>veh_indx</strong> – The index of this vehicle in ots lane (<em>for printing purpose only</em>)</li>
<li><strong>print</strong> – <code class="docutils literal notranslate"><span class="pre">True</span></code> if we want to print schedule</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.vehicle.Vehicle.test_trj_points">
<code class="descname">test_trj_points</code><span class="sig-paren">(</span><em>simulation_time</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/vehicle.html#Vehicle.test_trj_points"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.vehicle.Vehicle.test_trj_points" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Verifies the trajectory points for following cases:</dt>
<dd><ol class="first arabic simple">
<li>Non-negative speed (threshold is set to -3 m/s)</li>
<li>Non-negative distance (threshold is set to -3 m)</li>
<li>Expired trajectory point is not removed</li>
</ol>
<p class="last">todo add more tests</p>
</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>simulation_time</strong> – the current simulation clock</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="src.inter.vehicle.Vehicle.test_trj_redo_needed">
<code class="descname">test_trj_redo_needed</code><span class="sig-paren">(</span><em>min_dist=50</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/vehicle.html#Vehicle.test_trj_redo_needed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.vehicle.Vehicle.test_trj_redo_needed" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Checks if the trajectory model should be run (returns True) or not (False). Cases:</dt>
<dd><ol class="first last arabic simple">
<li>if last trj point is not assigned yet, do the trajectory.</li>
<li>if vehicle is closer than a certain distance, do NOT update the trajectory.</li>
</ol>
</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>min_dist</strong> – for lower than this (in meters), no trajectory optimization or car following will be applied</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<span class="target" id="module-src.inter.inter"></span><p>Intersection: gets parameters that are needed to specify the configuration of problem</p>
<dl class="class">
<dt id="src.inter.inter.Intersection">
<em class="property">class </em><code class="descclassname">src.inter.inter.</code><code class="descname">Intersection</code><span class="sig-paren">(</span><em>int_name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/inter.html#Intersection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.inter.Intersection" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Goals:</dt>
<dd><ol class="first last arabic simple">
<li>Keeps intersection parameters</li>
</ol>
</dd>
</dl>
<dl class="method">
<dt id="src.inter.inter.Intersection.get_poly_params">
<code class="descname">get_poly_params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/src/inter/inter.html#Intersection.get_poly_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#src.inter.inter.Intersection.get_poly_params" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">K and M</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="[1].traffic.html"
                        title="previous chapter">Input/Output</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="[3].trajectory.html"
                        title="next chapter">Trajectory Planner</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="[3].trajectory.html" title="Trajectory Planner"
             >next</a> |</li>
        <li class="right" >
          <a href="[1].traffic.html" title="Input/Output"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="ReadMe.html">AVIAN 1.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Mahmoud Pourmehrab.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>